### Chiến lược cốt lõi: "Mọi thứ đều có thể là một biến"

Chúng ta sẽ coi MVT không chỉ là một plugin, mà là một **"engine" tạo template**. Bất kỳ phần nào của một bài tập mà giáo viên muốn học sinh điền vào, hoặc muốn hệ thống tự động điền, đều sẽ được biểu diễn dưới dạng một biến `{}`.

---

### Các Block Template dựa trên `multiVariableText`

#### 1. Block "Điền vào chỗ trống" Nâng cao (Advanced Fill-in-the-Blank)

Đây là sự mở rộng tự nhiên của ý tưởng trước, nhưng với nhiều biến thể hơn.

*   **Usecase:** Tạo các đoạn văn, định nghĩa, hoặc bài tập ngữ pháp có nhiều chỗ trống cần điền.
*   **Kỹ thuật Tận dụng MVT:**
    *   **Cơ sở:** Sử dụng MVT làm nền tảng. Giáo viên soạn thảo văn bản như: "Động từ là những từ chỉ {hanh_dong} hoặc {trang_thai} của sự vật. Ví dụ: {vi_du_1}, {vi_du_2}."
    *   **Tùy biến UI (`formUiRender`):**
        *   **Kiểu 1: Ô gạch chân (Underlined Box):** Style cho các `span` `contentEditable` có `border-bottom: 1px solid black;` và một `min-width` nhất định để ô trống luôn có kích thước tối thiểu, tạo cảm giác trực quan.
        *   **Kiểu 2: Ô đóng khung (Boxed Input):** Style cho các `span` có `border: 1px solid #ccc; border-radius: 4px; padding: 2px 4px;`. Điều này rất hữu ích cho các bài tập điền công thức toán học hoặc các từ đơn lẻ.
    *   **Prop Panel:** Thêm một tùy chọn trong `propPanel` của plugin này, ví dụ `blankStyle: 'underline' | 'box'`, để giáo viên có thể chọn kiểu hiển thị cho các ô trống.

*   **Ví dụ:**
    *   Bài tập tiếng Anh: "I am interested in {preposition} learning new things."
    *   Bài tập Toán: "Diện tích hình chữ nhật được tính bằng công thức: S = {chieu_dai} x {chieu_rong}."

#### 2. Block "Bảng Dữ liệu/Bảng Thuật ngữ" (Data/Glossary Table)

*   **Usecase:** Tạo các bảng yêu cầu học sinh điền thông tin vào các ô cụ thể, hoặc giáo viên tạo bảng thuật ngữ với các định nghĩa sẵn.
*   **Kỹ thuật Tận dụng MVT & `table`:**
    *   Đây là sự kết hợp giữa `table` và `MVT`. Thay vì nội dung của ô trong bảng là một plugin `text` đơn giản, nó sẽ là một plugin `MVT`.
    *   **Triển khai:**
        1.  Tạo một custom plugin `tableWithMVT`.
        2.  Trong hàm `uiRender` và `pdfRender` của nó, khi lặp qua để tạo các ô, thay vì gọi `cell.ui` và `cell.pdf` (vốn dùng `text`), bạn sẽ gọi `multiVariableText.ui` và `multiVariableText.pdf`.
        3.  **Dữ liệu đầu vào:** `schema.content` của bảng sẽ là một mảng 2 chiều như bình thường. Nhưng `schema.inputs` (dữ liệu động) sẽ là một object chứa giá trị cho các biến.
    *   **Ví dụ 1 (Học sinh điền):**
        *   Giáo viên tạo bảng với 2 cột: "Thuật ngữ" và "Định nghĩa".
        *   Cột "Định nghĩa" sẽ chứa các MVT schema với `text: "{dinh_nghia_quang_hop}"`.
        *   Học sinh sẽ điền vào các ô trống trong cột "Định nghĩa".
    *   **Ví dụ 2 (Giáo viên tạo sẵn):**
        *   Giáo viên tạo một bảng "Tóm tắt Lịch sử" với các cột: "Sự kiện", "Thời gian", "Nhân vật chính".
        *   Toàn bộ bảng có thể là một MVT lớn: `text` của MVT sẽ là cấu trúc markdown của bảng, và `content` sẽ là dữ liệu JSON. Kỹ thuật này phức tạp hơn nhưng mạnh mẽ hơn.

#### 3. Block "Câu hỏi Đúng/Sai với Giải thích" (True/False with Justification)

*   **Usecase:** Tạo câu hỏi yêu cầu học sinh không chỉ chọn Đúng/Sai mà còn phải giải thích tại sao.
*   **Kỹ thuật Tận dụng MVT & `radioGroup`:**
    *   Đây là một **"template block"** kết hợp nhiều plugin.
    *   **Cấu trúc:**
        1.  **Đề bài:** Một plugin `text` cho nội dung nhận định. Ví dụ: "Mặt trời quay quanh Trái Đất."
        2.  **Lựa chọn Đúng/Sai:** Hai cặp `radioGroup` + `text` cho "Đúng" và "Sai".
        3.  **Phần giải thích:** Đây là điểm nhấn. Sử dụng một plugin MVT với `text: "Giải thích: {giai_thich_cua_hoc_sinh}"`.
    *   **Lợi ích:**
        *   Phần "Giải thích:" là văn bản tĩnh, học sinh không thể xóa.
        *   Học sinh chỉ có thể nhập vào vùng biến `{giai_thich_cua_hoc_sinh}`.
        *   Bạn có thể tùy biến vùng này thành một `LinedAnswerBox` (như đã đề xuất ở phân tích trước) để có dòng kẻ.

#### 4. Block "Tạo bài toán với dữ liệu ngẫu nhiên" (Randomized Math Problem)

Đây là một ý tưởng nâng cao nhưng cực kỳ giá trị, tận dụng khả năng xử lý dữ liệu đầu vào của MVT.

*   **Usecase:** Giáo viên tạo một mẫu bài toán, và hệ thống có thể tự động sinh ra nhiều phiên bản khác nhau của bài toán đó với các con số ngẫu nhiên.
*   **Kỹ thuật Tận dụng MVT:**
    *   **Mẫu bài toán:** Giáo viên tạo một MVT schema với `text`: "Một cửa hàng có {so_tao} quả táo. Mẹ mua thêm {so_tao_mua_them} quả nữa. Hỏi cửa hàng có tất cả bao nhiêu quả táo? Trả lời: {dap_an} quả."
    *   **Logic của Docubrand (Bên ngoài plugin):**
        1.  Trong giao diện của bạn, bên cạnh template, có một nút "Tạo phiên bản mới".
        2.  Khi nhấn nút, code của bạn sẽ:
            *   Tạo ra các số ngẫu nhiên, ví dụ: `so_tao = 15`, `so_tao_mua_them = 7`.
            *   Chuẩn bị một object `inputs` cho `pdfme`: `{ "bai_toan_tao": JSON.stringify({ so_tao: "15", so_tao_mua_them: "7" }) }`.
            *   **Phần đáp án `{dap_an}` sẽ được để trống cho học sinh điền.**
        3.  Khi render PDF (ví dụ, để tạo đáp án cho giáo viên), bạn có thể tính toán luôn đáp án và truyền vào: `{ "bai_toan_tao": JSON.stringify({ so_tao: "15", so_tao_mua_them: "7", dap_an: "22" }) }`.
    *   **Lợi ích:** Từ một template, giáo viên có thể tạo ra 20 đề khác nhau cho 20 học sinh, tránh gian lận.

#### 5. Block "Thư gửi Phụ huynh" hoặc "Giấy khen" (Parent Letter / Certificate)

*   **Usecase:** Tạo nhanh các mẫu tài liệu cá nhân hóa cho từng học sinh.
*   **Kỹ thuật Tận dụng MVT:**
    *   Đây là ứng dụng kinh điển của MVT.
    *   **Mẫu Giấy khen:**
        *   `text`: "Trao tặng em {ten_hoc_sinh}, học sinh lớp {lop}, đã đạt thành tích {thanh_tich} trong năm học {nam_hoc}."
        *   `content`: `{}` (để trống).
    *   **Tích hợp với Docubrand:**
        1.  Giáo viên thiết kế mẫu.
        2.  Trong giao diện quản lý của Docubrand, giáo viên có thể upload một file Excel/CSV chứa danh sách học sinh.
        3.  Hệ thống của bạn sẽ đọc file này, lặp qua từng hàng, và với mỗi học sinh, nó sẽ gọi `pdfme.generate` với `inputs` tương ứng.
        4.  Ví dụ, cho học sinh đầu tiên: `inputs = { "giay_khen_content": JSON.stringify({ ten_hoc_sinh: "Nguyễn Văn A", lop: "5A", thanh_tich: "Học sinh Giỏi", nam_hoc: "2023-2024" }) }`.
    *   **Kết quả:** Chỉ với một template và một danh sách, giáo viên có thể xuất ra hàng loạt giấy khen/thư gửi đã được cá nhân hóa.

### Tổng kết chiến lược tận dụng MVT

-   **Wrapper Plugins:** Tạo các plugin mới (như `FillInTheBlank`, `LinedAnswerBox`) bằng cách kế thừa MVT và chỉ tùy biến lại `uiRender` để có giao diện trực quan hơn cho mục đích giáo dục.
-   **Template Blocks:** Tạo các chức năng trong UI của Docubrand cho phép giáo viên kéo-thả các nhóm plugin đã được cấu hình sẵn (như `MultipleChoiceQuestion`, `LabeledDiagram`), trong đó MVT đóng vai trò là các ô nhập liệu.
-   **Tích hợp với luồng dữ liệu:** Xây dựng các tính năng trong Docubrand (bên ngoài `pdfme`) để chuẩn bị dữ liệu đầu vào (từ form, file CSV, hoặc sinh ngẫu nhiên) và truyền nó vào `inputs` của `pdfme.generate`. MVT sẽ là "người" nhận và hiển thị dữ liệu đó.

Bằng cách này, bạn không chỉ tạo ra một công cụ thiết kế, mà còn tạo ra một hệ thống sinh tài liệu tự động, giúp giải quyết các bài toán thực tế của giáo viên một cách hiệu quả.