### Chiến lược Tổng thể: "Plugin là các Block xây dựng"

Thay vì nghĩ mỗi plugin là một phần tử đơn lẻ, chúng ta sẽ coi mỗi "custom plugin" là một **"Block Nội dung Giáo dục"** hoàn chỉnh. Một block có thể là một plugin duy nhất được tùy biến sâu, hoặc là một nhóm các plugin cơ sở được cấu hình sẵn để hoạt động cùng nhau.

---

### Các Custom Plugin cần thiết cho Docubrand

#### 1. Plugin Câu hỏi Trắc nghiệm (MultipleChoiceQuestion)

Đây là block cơ bản nhất cho mọi bài kiểm tra.

*   **Mục đích & Usecase:** Tạo một câu hỏi hoàn chỉnh với phần đề bài và các lựa chọn A, B, C, D. Người dùng cuối chỉ có thể chọn một đáp án.

*   **Ý tưởng Triển khai & Kỹ thuật Tái sử dụng:**
    *   Đây không phải là một schema `type` mới, mà là một **"template block"** được tạo ra bằng cách nhóm các plugin cơ sở. Khi người dùng kéo "Block Trắc nghiệm" vào, nó sẽ tự động tạo ra một nhóm gồm:
        1.  **Đề bài:** Một plugin `text` cho phần nội dung câu hỏi.
        2.  **Các lựa chọn:** Mỗi lựa chọn (A, B, C, D) là một cặp gồm:
            *   Một plugin `radioGroup` để người dùng chọn.
            *   Một plugin `text` để hiển thị nội dung của lựa chọn đó.
    *   **Kỹ thuật Tận dụng:**
        *   **`radioGroup`:** Kỹ thuật **Event Bus** của `radioGroup` sẽ được sử dụng để đảm bảo khi chọn đáp án B, các đáp án A, C, D sẽ tự động bỏ chọn. Tất cả các `radioGroup` trong cùng một câu hỏi sẽ được gán cùng một `schema.group` (ví dụ: `group: "question-1"`).
        *   **`text`:** Dùng để hiển thị đề bài và nội dung các lựa chọn, cho phép giáo viên định dạng văn bản (in đậm, in nghiêng,...).
        *   **Grouping (của `pdfme`):** Giao diện của `pdfme` cho phép nhóm các schema lại với nhau. "Plugin" này thực chất là một chức năng trong UI của bạn, giúp tạo ra một nhóm schema đã được cấu hình sẵn chỉ bằng một thao tác.

*   **Cấu trúc Schema (Dự kiến):** Không có schema mới. Đây là một tập hợp các schema `text` và `radioGroup` đã có.

*   **Trải nghiệm Người dùng (UX):**
    *   **Giáo viên (Designer):** Kéo "Block Câu hỏi Trắc nghiệm" từ thanh công cụ vào trang. Sau đó chỉ cần chỉnh sửa nội dung của các plugin `text`.
    *   **Học sinh (Form):** Đọc câu hỏi và nhấp vào một trong các nút radio để chọn đáp án.

---

#### 2. Plugin Điền vào chỗ trống (FillInTheBlank)

*   **Mục đích & Usecase:** Tạo các câu hỏi yêu cầu điền từ/cụm từ vào chỗ trống. Ví dụ: "Thủ đô của Việt Nam là ______."

*   **Ý tưởng Triển khai & Kỹ thuật Tái sử dụng:**
    *   Đây là một **wrapper** hoàn hảo cho plugin **`multiVariableText` (MVT)**.
    *   **Kỹ thuật Tận dụng:**
        *   **`multiVariableText`:** Plugin này sẽ có `type` là `fillInTheBlank`. Giáo viên sẽ nhập câu hỏi với cú pháp của MVT, ví dụ: "Thủ đô của Việt Nam là {dap_an}."
        *   **Tùy biến `uiRender`:** Logic cốt lõi là tùy biến lại hàm `formUiRender` của MVT. Thay vì chỉ hiển thị một `span` với đường viền đứt nét, bạn sẽ style cho `span` `contentEditable` đó có `border-bottom: 1px solid black;` và không có `outline`. Điều này sẽ tạo ra một ô trống có gạch chân trực quan.
        *   **`text`:** Toàn bộ khả năng định dạng văn bản của `text` được kế thừa.

*   **Cấu trúc Schema (Dự kiến):** Sẽ là một `MultiVariableTextSchema` nhưng với `type: 'fillInTheBlank'`.

*   **Trải nghiệm Người dùng (UX):**
    *   **Giáo viên (Designer):** Gõ câu hỏi và đặt tên biến trong dấu `{}`.
    *   **Học sinh (Form):** Nhấp trực tiếp vào vùng gạch chân và gõ câu trả lời.

---

#### 3. Plugin Khung trả lời có dòng kẻ (LinedAnswerBox)

*   **Mục đích & Usecase:** Tạo ra một vùng để học sinh trả lời câu hỏi tự luận, nhưng có các dòng kẻ sẵn để giúp chữ viết ngay ngắn.

*   **Ý tưởng Triển khai & Kỹ thuật Tái sử dụng:**
    *   Đây là một custom plugin mới, nhưng được xây dựng bằng cách **tổ hợp (compose)** các plugin cơ sở.
    *   **Kỹ thuật Tận dụng:**
        *   **Lớp nền (Input):** Sử dụng plugin `text` làm nền. `div` `contentEditable` của nó sẽ là nơi học sinh nhập câu trả lời. Bạn cần đặt `backgroundColor` của nó là trong suốt.
        *   **Vẽ dòng kẻ (Custom Logic):**
            *   **Trong `uiRender`:** Dựa vào `schema.height` và một thuộc tính mới `lineSpacing`, bạn tính toán số lượng dòng kẻ cần vẽ. Sau đó, dùng một vòng lặp để tạo ra các `div` với `border-bottom` và `position: absolute` để tạo ra các dòng kẻ. Các `div` này nằm **phía sau** `div` nhập liệu của plugin `text`.
            *   **Trong `pdfRender`:** Tương tự, trước khi gọi `text.pdf` để vẽ câu trả lời của học sinh, bạn dùng một vòng lặp và gọi `page.drawLine` nhiều lần để vẽ các đường kẻ lên PDF.
        *   **Đồng bộ `lineHeight`:** Để văn bản của học sinh khớp với các dòng kẻ, `schema.lineHeight` của plugin `text` nền cần được tính toán và đặt tự động dựa trên `schema.lineSpacing`.

*   **Cấu trúc Schema (Dự kiến):** Kế thừa `TextSchema` và thêm:
    *   `lineSpacing: number` (khoảng cách giữa các dòng kẻ, tính bằng mm).
    *   `lineColor: string` (màu của dòng kẻ).

*   **Trải nghiệm Người dùng (UX):**
    *   **Giáo viên (Designer):** Kéo block vào, điều chỉnh kích thước (width, height) và khoảng cách dòng kẻ.
    *   **Học sinh (Form):** Gõ câu trả lời vào khung, và văn bản sẽ nằm trên các dòng kẻ đã có.

---

#### 4. Plugin Sơ đồ có Chú thích (LabeledDiagram)

*   **Mục đích & Usecase:** Tạo các bài tập yêu cầu học sinh điền tên các bộ phận của một sơ đồ, hình ảnh (ví dụ: cấu tạo của một bông hoa, các bộ phận của cơ thể người).

*   **Ý tưởng Triển khai & Kỹ thuật Tái sử dụng:**
    *   Tương tự "MultipleChoiceQuestion", đây là một **"template block"** được tạo bằng cách nhóm các plugin cơ sở.
    *   **Kỹ thuật Tận dụng:**
        *   **`image`:** Một plugin `image` ở trung tâm để chứa sơ đồ/hình ảnh cần chú thích.
        *   **`line`:** Các plugin `line` được dùng để vẽ các đường chỉ từ chú thích đến các bộ phận trên hình ảnh.
        *   **`fillInTheBlank` (đã tạo ở trên):** Mỗi chú thích sẽ là một plugin `fillInTheBlank`. Ví dụ: "1. {bo_phan_1}", "2. {bo_phan_2}". Điều này cho phép học sinh điền trực tiếp vào các ô chú thích.
        *   **Grouping (của `pdfme`):** Toàn bộ các plugin `image`, `line`, `fillInTheBlank` này được nhóm lại thành một khối duy nhất, có thể di chuyển và thay đổi kích thước cùng nhau.

*   **Cấu trúc Schema (Dự kiến):** Không có schema mới. Là một tập hợp các schema `image`, `line`, và `fillInTheBlank`.

*   **Trải nghiệm Người dùng (UX):**
    *   **Giáo viên (Designer):** Kéo block vào, thay ảnh nền, điều chỉnh vị trí các đường chỉ và các ô chú thích.
    *   **Học sinh (Form):** Nhìn vào sơ đồ và điền câu trả lời vào các ô chú thích.

---

#### 5. Plugin Bài tập Nối cột (MatchingExercise)

*   **Mục đích & Usecase:** Tạo bài tập nối cột A với cột B.

*   **Ý tưởng Triển khai & Kỹ thuật Tái sử dụng:**
    *   Đây là một trường hợp sử dụng chuyên biệt của plugin **`table`**.
    *   **Kỹ thuật Tận dụng:**
        *   **`table`:** "Plugin" này thực chất là một nút trên UI của bạn, khi được nhấn, sẽ tạo ra một plugin `table` đã được cấu hình sẵn.
        *   **Cấu hình sẵn:** Bảng sẽ được tạo với 3 cột:
            1.  **Cột A:** Chứa các mục cần nối (ví dụ: "1. Con chó").
            2.  **Cột B (Cột trả lời):** Chứa các ô input để học sinh điền đáp án (ví dụ: "C"). Cột này có thể được style với chiều rộng hẹp. Mỗi ô trong cột này là một plugin `text` có thể chỉnh sửa.
            3.  **Cột C:** Chứa các mục để được nối tới (ví dụ: "A. Gâu gâu", "B. Meo meo", "C. Woof woof").
        *   **Tùy biến `uiRender` của `table`:** Có thể tùy biến nhẹ để các ô ở cột B có giao diện giống ô input hơn (ví dụ: có border rõ ràng).

*   **Cấu trúc Schema (Dự kiến):** Một `TableSchema` được tạo sẵn với cấu trúc 3 cột và các style mặc định.

*   **Trải nghiệm Người dùng (UX):**
    *   **Giáo viên (Designer):** Kéo block vào và chỉ cần điền nội dung cho Cột A và Cột C.
    *   **Học sinh (Form):** Điền đáp án (A, B, C,...) vào các ô ở Cột B.

### Kết luận và Lời khuyên

Chiến lược tốt nhất cho dự án **Docubrand** của bạn là **tư duy theo hướng tổ hợp và mở rộng**.

1.  **Xác định các "Block" cơ bản:** Như các ví dụ trên (trắc nghiệm, điền từ, tự luận,...).
2.  **Phân tích Block:** Với mỗi block, hãy tự hỏi: "Tôi có thể xây dựng nó bằng cách kết hợp các plugin `text`, `image`, `table`, `MVT`... đã có không?"
3.  **Ưu tiên "Template Block":** Đối với các block là sự kết hợp của nhiều schema (như Trắc nghiệm, Sơ đồ), hãy tập trung vào việc tạo một giao diện người dùng trong Docubrand cho phép kéo-thả các nhóm schema đã được cấu hình sẵn.
4.  **Tạo "Wrapper Plugin" khi cần:** Chỉ khi một block yêu cầu một hành vi UI hoặc PDF hoàn toàn mới mà không thể đạt được bằng cách tổ hợp (như `LinedAnswerBox`), bạn mới nên tạo một custom plugin mới bằng cách kế thừa từ một plugin cơ sở và tùy biến lại các hàm `ui` và `pdf` của nó.

Bằng cách này, bạn sẽ tận dụng được toàn bộ sức mạnh, sự ổn định và các kỹ thuật phức tạp đã được xây dựng sẵn trong bộ plugin của `pdfme`, giúp bạn tập trung vào việc xây dựng trải nghiệm người dùng độc đáo cho Docubrand.